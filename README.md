# üåÑ FSTR Pereval API

REST API –¥–ª—è –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–π —Å–ª—É–∂–±—ã —Ç—É—Ä–∏–∑–º–∞ –†–æ—Å—Å–∏–∏ (–§–°–¢–†) –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã–º–∏ –æ –≥–æ—Ä–Ω—ã—Ö –ø–µ—Ä–µ–≤–∞–ª–∞—Ö.  
–ü—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç—É—Ä–∏—Å—Ç–∞–º –¥–æ–±–∞–≤–ª—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–µ—Ä–µ–≤–∞–ª–∞—Ö, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö (–≤ —Å—Ç–∞—Ç—É—Å–µ "new") –∏ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.

## üìå –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã API

| –ú–µ—Ç–æ–¥       | –ü—É—Ç—å                     | –û–ø–∏—Å–∞–Ω–∏–µ                                      |
|-------------|--------------------------|-----------------------------------------------|
| `POST`      | `/submitData`            | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä–µ–≤–∞–ª–∞                    |
| `GET`       | `/submitData/{id}`       | –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–≤–∞–ª–∞ –ø–æ ID               |
| `PATCH`     | `/submitData/{id}`       | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–∞–ª–∞ (—Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å "new") |
| `GET`       | `/submitDataByEmail`     | –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–≤–∞–ª–æ–≤ –ø–æ email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è         |

## –°—Ç–∞—Ç—É—Å—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- `new` - –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å (–º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å)
- `pending` - –º–æ–¥–µ—Ä–∞—Ç–æ—Ä –≤–∑—è–ª –≤ —Ä–∞–±–æ—Ç—É
- `accepted` - –º–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ
- `rejected` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–Ω—è—Ç–∞

## üîç –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ **—Ç–æ–ª—å–∫–æ** –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å –∏–º–µ–µ—Ç —Å—Ç–∞—Ç—É—Å `new`
- **–ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω—è—Ç—å** –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  - –§–ò–û (`fam`, `name`, `otc`)
  - Email
  - –¢–µ–ª–µ—Ñ–æ–Ω (`phone`)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.9+
- PostgreSQL 14+

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/qXstay/pereval_api.git
cd pereval_api

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–æ–∑–¥–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
psql -U postgres -c "CREATE DATABASE pereval;"

# –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
psql -U postgres -c "CREATE USER pereval_user WITH PASSWORD 'pereval_password';"

# –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ö–µ–º—É –ë–î
psql -U postgres -d pereval -f init_db.sql
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```env
FSTR_DB_HOST=localhost
FSTR_DB_PORT=5432
FSTR_DB_NAME=pereval
FSTR_DB_LOGIN=pereval_user
FSTR_DB_PASS=pereval_password
```

### –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
```bash
uvicorn main:app --reload
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: [http://localhost:8000](http://localhost:8000)

## üìÑ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–ü—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000/docs
### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–µ—Ä–µ–≤–∞–ª–∞
**Endpoint:** `POST /submitData`  
**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (–ø—Ä–∏–º–µ—Ä):**
```json
{
  "beauty_title": "–ø–µ—Ä.",
  "title": "–ü—Ö–∏—è",
  "other_titles": "–¢—Ä–∏–µ–≤",
  "connect": "",
  "add_time": "2021-09-22 13:18:13",
  "user": {
    "email": "user@example.com",
    "fam": "–ü—É–ø–∫–∏–Ω",
    "name": "–í–∞—Å–∏–ª–∏–π",
    "otc": "–ò–≤–∞–Ω–æ–≤–∏—á",
    "phone": "+7 555 55 55"
  },
  "coords": {
    "latitude": "45.3842",
    "longitude": "7.1525",
    "height": "1200"
  },
  "level": {
    "winter": "",
    "summer": "1–ê",
    "autumn": "1–ê",
    "spring": ""
  },
  "images": [
    {
      "data": "iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAEhQGAhKmMIQAAAABJRU5ErkJggg==",
      "title": "–°–µ–¥–ª–æ–≤–∏–Ω–∞"
    }
  ]
}
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": 200,
  "message": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ",
  "id": 42
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø–µ—Ä–µ–≤–∞–ª–µ
**Endpoint:** `GET /submitData/{id}`  
**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X GET "http://localhost:8000/submitData/42"
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "id": 42,
  "beauty_title": "–ø–µ—Ä.",
  "title": "–ü—Ö–∏—è",
  "status": "new",
  "user": {
    "email": "user@example.com",
    "fam": "–ü—É–ø–∫–∏–Ω",
    "name": "–í–∞—Å–∏–ª–∏–π",
    "otc": "–ò–≤–∞–Ω–æ–≤–∏—á",
    "phone": "+7 555 55 55"
  },
  "coords": {
    "latitude": 45.3842,
    "longitude": 7.1525,
    "height": 1200
  },
  "level": {
    "winter": "",
    "summer": "1–ê",
    "autumn": "1–ê",
    "spring": ""
  },
  "images": [
    {
      "id": 1,
      "title": "–°–µ–¥–ª–æ–≤–∏–Ω–∞",
      "data": "base64-encoded-image"
    }
  ]
}
```

### 3. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–∞–ª–∞
**Endpoint:** `PATCH /submitData/{id}`  
**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—è–µ–º—ã–µ –ø–æ–ª—è):**
```json
{
  "title": "–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
  "level": {
    "summer": "2–ë"
  }
}
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": 1,
  "message": "–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞",
  "id": 42
}
```

**–û—à–∏–±–∫–∞ (—Å—Ç–∞—Ç—É—Å –Ω–µ 'new'):**
```json
{
  "status": 0,
  "message": "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ: –∑–∞–ø–∏—Å—å –Ω–µ –≤ —Å—Ç–∞—Ç—É—Å–µ 'new'",
  "id": 42
}
```

### 4. –ü–æ–∏—Å–∫ –ø–µ—Ä–µ–≤–∞–ª–æ–≤ –ø–æ email
**Endpoint:** `GET /submitDataByEmail?user_email=user@example.com`  
**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X GET "http://localhost:8000/submitDataByEmail?user_email=user@example.com"
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 42,
    "beauty_title": "–ø–µ—Ä.",
    "title": "–ü—Ö–∏—è",
    "other_titles": "–¢—Ä–∏–µ–≤",
    "connect": "",
    "add_time": "2021-09-22T13:18:13",
    "status": "new",
    "level": {
      "winter": "",
      "summer": "1–ê",
      "autumn": "1–ê",
      "spring": ""
    }
  }
]
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
python manual_test.py

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
python test_db.py

# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ —Ç–µ—Å—Ç–æ–≤:
# === 1. –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ===
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ—á–∏—â–µ–Ω–∞
# === 2. POST /submitData ===
# 200 {'status': 200, 'message': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ', 'id': 1}
# Exists in DB: yes
```

## üîç Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:  
[http://localhost:8000/docs](http://localhost:8000/docs) (–ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ)

## ‚ö†Ô∏è –û—à–∏–±–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ
```json
{
  "status": 400,
  "message": "Bad Request: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–∞–Ω–Ω—ã—Ö",
  "id": null
}
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω—ã:

| –ü–æ–ª–µ         | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ |
|--------------|--------------|
| beauty_title | ‚úì            |
| title        | ‚úì            |
| user.email   | ‚úì            |
| user.fam     | ‚úì            |
| user.name    | ‚úì            |
| user.phone   | ‚úì            |
| coords       | ‚úì            |
| level.summer | ‚úì            |
| level.autumn | ‚úì            |
| images       | ‚úì (min 1)    |


## üß™ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã
–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –Ω–∞–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤, –ø—Ä–æ–≤–µ—Ä—è—é—â–∏—Ö:
- –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ–≤–∞–ª–æ–º (—Å–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:
```bash
pytest test_main.py -v